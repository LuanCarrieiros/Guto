{% extends "base.html" %}
{% load static %}

{% block title %}Bloqueios de Funcionalidade - Sistema GUTO{% endblock %}

{% block extra_css %}
<style>
    /* Animation keyframes */
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Component styles */
    .animate-slideInUp {
        animation: slideInUp 0.5s ease-out;
    }

    .animate-fadeIn {
        animation: fadeIn 0.3s ease-out;
    }

    .animate-pulse-custom {
        animation: pulse 2s infinite;
    }

    .animate-shake {
        animation: shake 0.5s ease-in-out;
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }

    .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .status-active {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .status-inactive {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .status-scheduled {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .filter-chip {
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .filter-chip:hover {
        transform: scale(1.05);
    }

    .filter-chip.active {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
    }

    .modal-overlay {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
    }

    .loading-shimmer {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }

    .timeline-item::before {
        content: '';
        position: absolute;
        left: 19px;
        top: 24px;
        bottom: -8px;
        width: 2px;
        background: linear-gradient(180deg, #e5e7eb 0%, #f3f4f6 100%);
    }

    .timeline-item:last-child::before {
        display: none;
    }

    .severity-critical {
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
    }

    .severity-high {
        background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
    }

    .severity-medium {
        background: linear-gradient(135deg, #ca8a04 0%, #a16207 100%);
    }

    .severity-low {
        background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .card-hover:hover {
            transform: none;
        }
        
        .filter-chip {
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between py-6">
                <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-ban text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Bloqueios de Funcionalidade</h1>
                        <p class="text-gray-600">Gerenciar bloqueios e restrições do sistema</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="showCreateModal()" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white text-sm font-medium rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>
                        Novo Bloqueio
                    </button>
                    <button onclick="refreshData()" class="inline-flex items-center px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-lg border border-gray-300 hover:bg-gray-50 transition-all duration-200 shadow-sm hover:shadow-md">
                        <i class="fas fa-sync-alt mr-2" id="refreshIcon"></i>
                        Atualizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover animate-slideInUp">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-ban text-white"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Bloqueios Ativos</p>
                        <p class="text-2xl font-bold text-gray-900" id="activeBlocosCount">12</p>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="flex items-center text-sm text-red-600">
                        <i class="fas fa-arrow-up mr-1"></i>
                        <span>+3 esta semana</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover animate-slideInUp" style="animation-delay: 0.1s">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-clock text-white"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Programados</p>
                        <p class="text-2xl font-bold text-gray-900" id="scheduledBlocosCount">8</p>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="flex items-center text-sm text-amber-600">
                        <i class="fas fa-calendar mr-1"></i>
                        <span>Próximos 7 dias</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover animate-slideInUp" style="animation-delay: 0.2s">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-check-circle text-white"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Resolvidos</p>
                        <p class="text-2xl font-bold text-gray-900" id="resolvedBlocosCount">45</p>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="flex items-center text-sm text-green-600">
                        <i class="fas fa-arrow-down mr-1"></i>
                        <span>-5 esta semana</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover animate-slideInUp" style="animation-delay: 0.3s">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-white"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Usuários Afetados</p>
                        <p class="text-2xl font-bold text-gray-900" id="affectedUsersCount">156</p>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="flex items-center text-sm text-purple-600">
                        <i class="fas fa-percentage mr-1"></i>
                        <span>12% dos usuários</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 animate-slideInUp">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div class="flex flex-wrap gap-2">
                    <span class="text-sm font-medium text-gray-700 mr-2">Filtros:</span>
                    <button class="filter-chip active px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="all">
                        Todos
                    </button>
                    <button class="filter-chip px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="active">
                        Ativos
                    </button>
                    <button class="filter-chip px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="scheduled">
                        Programados
                    </button>
                    <button class="filter-chip px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="expired">
                        Expirados
                    </button>
                    <button class="filter-chip px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="critical">
                        Críticos
                    </button>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="Buscar bloqueios..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-64">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <select id="severityFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="">Todas as Severidades</option>
                        <option value="critical">Crítica</option>
                        <option value="high">Alta</option>
                        <option value="medium">Média</option>
                        <option value="low">Baixa</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Bloqueios List -->
        <div class="space-y-6" id="blocosList">
            <!-- Active Block -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover animate-slideInUp bloco-card" data-status="active" data-severity="critical">
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 severity-critical rounded-full flex items-center justify-center mr-4">
                                    <i class="fas fa-exclamation-triangle text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Sistema de Pagamentos Bloqueado</h3>
                                    <p class="text-gray-600">Módulo de pagamentos temporariamente indisponível</p>
                                </div>
                                <div class="ml-4">
                                    <span class="status-active text-white px-3 py-1 rounded-full text-sm font-medium">
                                        <i class="fas fa-circle animate-pulse-custom mr-1"></i>
                                        Ativo
                                    </span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <p class="text-sm text-gray-500">Início</p>
                                    <p class="font-medium text-gray-900">01/09/2025 09:00</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Previsão de Fim</p>
                                    <p class="font-medium text-gray-900">01/09/2025 18:00</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Usuários Afetados</p>
                                    <p class="font-medium text-gray-900">89 usuários</p>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-500 mb-2">Descrição</p>
                                <p class="text-gray-700">Manutenção programada no sistema de pagamentos para implementação de novas funcionalidades de segurança. Todas as transações financeiras estão temporariamente suspensas.</p>
                            </div>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium">Crítico</span>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium">Pagamentos</span>
                                <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium">Manutenção</span>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 mt-4 lg:mt-0 lg:ml-6">
                            <button onclick="editBloco(1)" class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-all duration-200">
                                <i class="fas fa-edit mr-2"></i>
                                Editar
                            </button>
                            <button onclick="resolveBloco(1)" class="inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-all duration-200">
                                <i class="fas fa-check mr-2"></i>
                                Resolver
                            </button>
                            <button onclick="deleteBloco(1)" class="inline-flex items-center px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-all duration-200">
                                <i class="fas fa-trash mr-2"></i>
                                Excluir
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-6 py-3">
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <span>Criado por: <strong>Admin Sistema</strong></span>
                        <span>Última atualização: <strong>há 2 horas</strong></span>
                    </div>
                </div>
            </div>

            <!-- Scheduled Block -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover animate-slideInUp bloco-card" data-status="scheduled" data-severity="high" style="animation-delay: 0.1s">
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 severity-high rounded-full flex items-center justify-center mr-4">
                                    <i class="fas fa-calendar-times text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Manutenção do Servidor Principal</h3>
                                    <p class="text-gray-600">Sistema ficará indisponível durante a madrugada</p>
                                </div>
                                <div class="ml-4">
                                    <span class="status-scheduled text-white px-3 py-1 rounded-full text-sm font-medium">
                                        <i class="fas fa-clock mr-1"></i>
                                        Programado
                                    </span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <p class="text-sm text-gray-500">Início Programado</p>
                                    <p class="font-medium text-gray-900">02/09/2025 02:00</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Fim Programado</p>
                                    <p class="font-medium text-gray-900">02/09/2025 06:00</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Usuários Afetados</p>
                                    <p class="font-medium text-gray-900">Todos os usuários</p>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-500 mb-2">Descrição</p>
                                <p class="text-gray-700">Atualização do sistema operacional e patches de segurança. Durante este período, o sistema estará completamente indisponível para todos os usuários.</p>
                            </div>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs font-medium">Alta</span>
                                <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs font-medium">Servidor</span>
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium">Atualização</span>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 mt-4 lg:mt-0 lg:ml-6">
                            <button onclick="editBloco(2)" class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-all duration-200">
                                <i class="fas fa-edit mr-2"></i>
                                Editar
                            </button>
                            <button onclick="cancelBloco(2)" class="inline-flex items-center px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-all duration-200">
                                <i class="fas fa-times mr-2"></i>
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-6 py-3">
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <span>Criado por: <strong>João Silva</strong></span>
                        <span>Programado para: <strong>em 18 horas</strong></span>
                    </div>
                </div>
            </div>

            <!-- Resolved Block -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover animate-slideInUp bloco-card" data-status="resolved" data-severity="medium" style="animation-delay: 0.2s">
                <div class="p-6 opacity-75">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gray-400 rounded-full flex items-center justify-center mr-4">
                                    <i class="fas fa-check-circle text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Problema de Login Resolvido</h3>
                                    <p class="text-gray-600">Falha no sistema de autenticação foi corrigida</p>
                                </div>
                                <div class="ml-4">
                                    <span class="bg-gray-400 text-white px-3 py-1 rounded-full text-sm font-medium">
                                        <i class="fas fa-check-circle mr-1"></i>
                                        Resolvido
                                    </span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <p class="text-sm text-gray-500">Início</p>
                                    <p class="font-medium text-gray-900">31/08/2025 14:30</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Resolução</p>
                                    <p class="font-medium text-gray-900">31/08/2025 16:45</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Duração</p>
                                    <p class="font-medium text-gray-900">2h 15min</p>
                                </div>
                            </div>
                            <div class="mb-4">
                                <p class="text-sm text-gray-500 mb-2">Resolução</p>
                                <p class="text-gray-700">Problema no servidor de autenticação foi identificado e corrigido. Todos os usuários já podem fazer login normalmente.</p>
                            </div>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium">Média</span>
                                <span class="px-2 py-1 bg-indigo-100 text-indigo-800 rounded text-xs font-medium">Autenticação</span>
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium">Resolvido</span>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 mt-4 lg:mt-0 lg:ml-6">
                            <button onclick="viewBloco(3)" class="inline-flex items-center px-3 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-all duration-200">
                                <i class="fas fa-eye mr-2"></i>
                                Visualizar
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-6 py-3">
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <span>Resolvido por: <strong>Maria Santos</strong></span>
                        <span>Tempo de resolução: <strong>2h 15min</strong></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Load More -->
        <div class="text-center mt-8">
            <button onclick="loadMoreBlocos()" class="inline-flex items-center px-6 py-3 bg-white text-gray-700 font-medium rounded-lg border border-gray-300 hover:bg-gray-50 transition-all duration-200 shadow-sm hover:shadow-md" id="loadMoreBtn">
                <i class="fas fa-arrow-down mr-2"></i>
                Carregar Mais Bloqueios
            </button>
        </div>
    </div>
</div>

<!-- Create/Edit Modal -->
<div id="blocoModal" class="fixed inset-0 z-50 hidden modal-overlay">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-slideInUp">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold text-gray-900" id="modalTitle">Novo Bloqueio</h2>
                    <button onclick="closeBlocoModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <form id="blocoForm" class="p-6 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Título do Bloqueio *</label>
                        <input type="text" id="blocoTitulo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Digite o título do bloqueio" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Severidade *</label>
                        <select id="blocoSeveridade" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            <option value="">Selecione a severidade</option>
                            <option value="critical">Crítica</option>
                            <option value="high">Alta</option>
                            <option value="medium">Média</option>
                            <option value="low">Baixa</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Bloqueio *</label>
                        <select id="blocoTipo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            <option value="">Selecione o tipo</option>
                            <option value="sistema">Sistema Completo</option>
                            <option value="modulo">Módulo Específico</option>
                            <option value="funcionalidade">Funcionalidade</option>
                            <option value="usuario">Usuário</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data/Hora de Início *</label>
                        <input type="datetime-local" id="blocoInicio" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data/Hora de Fim</label>
                        <input type="datetime-local" id="blocoFim" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Descrição *</label>
                    <textarea id="blocoDescricao" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Descreva o motivo do bloqueio e impactos esperados" required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usuários/Grupos Afetados</label>
                    <textarea id="blocoAfetados" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Liste os usuários ou grupos afetados (opcional)"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                    <input type="text" id="blocoTags" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Tags separadas por vírgula (ex: manutenção, crítico, pagamentos)">
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="blocoNotificar" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                    <label for="blocoNotificar" class="ml-2 block text-sm text-gray-900">
                        Notificar usuários afetados por email
                    </label>
                </div>
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                    <button type="button" onclick="closeBlocoModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200">
                        <i class="fas fa-save mr-2"></i>
                        Salvar Bloqueio
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="fixed inset-0 z-50 hidden modal-overlay">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full animate-slideInUp">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900" id="confirmTitle">Confirmar Ação</h3>
                        <p class="text-gray-600" id="confirmMessage">Esta ação não pode ser desfeita.</p>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeConfirmModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmButton" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
class BlocoSystem {
    constructor() {
        this.blocos = [];
        this.currentFilter = 'all';
        this.currentPage = 1;
        this.itemsPerPage = 10;
        this.searchTerm = '';
        this.severityFilter = '';
        
        this.initializeEventListeners();
        this.loadBlocos();
    }

    initializeEventListeners() {
        // Filter chips
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                this.currentFilter = e.target.dataset.filter;
                this.filterBlocos();
            });
        });

        // Search input
        const searchInput = document.getElementById('searchInput');
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                this.searchTerm = e.target.value.toLowerCase();
                this.filterBlocos();
            }, 300);
        });

        // Severity filter
        document.getElementById('severityFilter').addEventListener('change', (e) => {
            this.severityFilter = e.target.value;
            this.filterBlocos();
        });

        // Form submission
        document.getElementById('blocoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveBlocoForm();
        });
    }

    loadBlocos() {
        // Simulate loading blocos
        this.updateStatistics();
        this.filterBlocos();
    }

    filterBlocos() {
        const cards = document.querySelectorAll('.bloco-card');
        let visibleCount = 0;

        cards.forEach(card => {
            let visible = true;
            const status = card.dataset.status;
            const severity = card.dataset.severity;

            // Filter by status
            if (this.currentFilter !== 'all' && status !== this.currentFilter) {
                visible = false;
            }

            // Filter by severity
            if (this.severityFilter && severity !== this.severityFilter) {
                visible = false;
            }

            // Filter by search term
            if (this.searchTerm) {
                const text = card.textContent.toLowerCase();
                if (!text.includes(this.searchTerm)) {
                    visible = false;
                }
            }

            if (visible) {
                card.style.display = 'block';
                card.style.animationDelay = (visibleCount * 0.1) + 's';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // Show no results message if needed
        this.showNoResultsMessage(visibleCount === 0);
    }

    showNoResultsMessage(show) {
        const existingMessage = document.getElementById('noResults');
        
        if (show && !existingMessage) {
            const message = document.createElement('div');
            message.id = 'noResults';
            message.className = 'text-center py-12';
            message.innerHTML = `
                <div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-search text-gray-400 text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum bloqueio encontrado</h3>
                <p class="text-gray-600">Tente ajustar os filtros ou criar um novo bloqueio.</p>
            `;
            document.getElementById('blocosList').appendChild(message);
        } else if (!show && existingMessage) {
            existingMessage.remove();
        }
    }

    updateStatistics() {
        // Update statistics cards with animation
        const stats = {
            active: Math.floor(Math.random() * 20) + 5,
            scheduled: Math.floor(Math.random() * 15) + 3,
            resolved: Math.floor(Math.random() * 100) + 20,
            affected: Math.floor(Math.random() * 500) + 50
        };

        this.animateCounter('activeBlocosCount', stats.active);
        this.animateCounter('scheduledBlocosCount', stats.scheduled);
        this.animateCounter('resolvedBlocosCount', stats.resolved);
        this.animateCounter('affectedUsersCount', stats.affected);
    }

    animateCounter(elementId, targetValue) {
        const element = document.getElementById(elementId);
        const startValue = 0;
        const duration = 2000;
        const startTime = performance.now();

        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
            
            element.textContent = currentValue;

            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };

        requestAnimationFrame(animate);
    }

    saveBlocoForm() {
        const formData = {
            titulo: document.getElementById('blocoTitulo').value,
            severidade: document.getElementById('blocoSeveridade').value,
            tipo: document.getElementById('blocoTipo').value,
            inicio: document.getElementById('blocoInicio').value,
            fim: document.getElementById('blocoFim').value,
            descricao: document.getElementById('blocoDescricao').value,
            afetados: document.getElementById('blocoAfetados').value,
            tags: document.getElementById('blocoTags').value,
            notificar: document.getElementById('blocoNotificar').checked
        };

        // Simulate saving
        this.showNotification('success', 'Bloqueio salvo com sucesso!');
        this.closeBlocoModal();
        
        // Refresh data
        setTimeout(() => {
            this.loadBlocos();
        }, 1000);
    }

    showNotification(type, message) {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white animate-slideInUp ${
            type === 'success' ? 'bg-green-500' : 
            type === 'error' ? 'bg-red-500' : 
            'bg-blue-500'
        }`;
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas ${type === 'success' ? 'fa-check' : type === 'error' ? 'fa-times' : 'fa-info'} mr-2"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'fadeOut 0.3s ease-out forwards';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    closeBlocoModal() {
        document.getElementById('blocoModal').classList.add('hidden');
        document.getElementById('blocoForm').reset();
    }

    closeConfirmModal() {
        document.getElementById('confirmModal').classList.add('hidden');
    }
}

// Global functions
function showCreateModal() {
    document.getElementById('modalTitle').textContent = 'Novo Bloqueio';
    document.getElementById('blocoModal').classList.remove('hidden');
}

function editBloco(id) {
    document.getElementById('modalTitle').textContent = 'Editar Bloqueio';
    document.getElementById('blocoModal').classList.remove('hidden');
    
    // Simulate loading bloco data
    setTimeout(() => {
        document.getElementById('blocoTitulo').value = 'Sistema de Pagamentos Bloqueado';
        document.getElementById('blocoSeveridade').value = 'critical';
        document.getElementById('blocoTipo').value = 'modulo';
    }, 100);
}

function resolveBloco(id) {
    document.getElementById('confirmTitle').textContent = 'Resolver Bloqueio';
    document.getElementById('confirmMessage').textContent = 'Tem certeza que deseja marcar este bloqueio como resolvido?';
    document.getElementById('confirmButton').onclick = () => {
        blocoSystem.showNotification('success', 'Bloqueio resolvido com sucesso!');
        blocoSystem.closeConfirmModal();
        setTimeout(() => blocoSystem.loadBlocos(), 1000);
    };
    document.getElementById('confirmModal').classList.remove('hidden');
}

function deleteBloco(id) {
    document.getElementById('confirmTitle').textContent = 'Excluir Bloqueio';
    document.getElementById('confirmMessage').textContent = 'Tem certeza que deseja excluir este bloqueio permanentemente?';
    document.getElementById('confirmButton').onclick = () => {
        blocoSystem.showNotification('success', 'Bloqueio excluído com sucesso!');
        blocoSystem.closeConfirmModal();
        setTimeout(() => blocoSystem.loadBlocos(), 1000);
    };
    document.getElementById('confirmModal').classList.remove('hidden');
}

function cancelBloco(id) {
    document.getElementById('confirmTitle').textContent = 'Cancelar Bloqueio';
    document.getElementById('confirmMessage').textContent = 'Tem certeza que deseja cancelar este bloqueio programado?';
    document.getElementById('confirmButton').onclick = () => {
        blocoSystem.showNotification('success', 'Bloqueio cancelado com sucesso!');
        blocoSystem.closeConfirmModal();
        setTimeout(() => blocoSystem.loadBlocos(), 1000);
    };
    document.getElementById('confirmModal').classList.remove('hidden');
}

function viewBloco(id) {
    blocoSystem.showNotification('info', 'Abrindo detalhes do bloqueio...');
}

function closeBlocoModal() {
    blocoSystem.closeBlocoModal();
}

function closeConfirmModal() {
    blocoSystem.closeConfirmModal();
}

function refreshData() {
    const refreshIcon = document.getElementById('refreshIcon');
    refreshIcon.classList.add('animate-spin');
    
    setTimeout(() => {
        refreshIcon.classList.remove('animate-spin');
        blocoSystem.loadBlocos();
        blocoSystem.showNotification('success', 'Dados atualizados com sucesso!');
    }, 1000);
}

function loadMoreBlocos() {
    const button = document.getElementById('loadMoreBtn');
    const originalText = button.innerHTML;
    
    button.innerHTML = '<i class="fas fa-spinner animate-spin mr-2"></i>Carregando...';
    button.disabled = true;
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
        blocoSystem.showNotification('info', 'Mais bloqueios carregados!');
    }, 2000);
}

// Initialize system
let blocoSystem;
document.addEventListener('DOMContentLoaded', function() {
    blocoSystem = new BlocoSystem();
});

// Handle escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        blocoSystem.closeBlocoModal();
        blocoSystem.closeConfirmModal();
    }
});
</script>
{% endblock %}