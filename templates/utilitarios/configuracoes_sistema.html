{% extends 'base.html' %}
{% load static %}

{% block title %}Configurações do Sistema - GUTO{% endblock %}

{% block extra_css %}
<style>
    .config-card {
        transition: all 0.3s ease;
    }
    
    .config-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    }
    
    .config-category {
        border-left: 4px solid transparent;
        transition: all 0.2s ease;
    }
    
    .config-category.active {
        border-left-color: #4F46E5;
        background: linear-gradient(135deg, #EEF2FF, #E0E7FF);
    }
    
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 24px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
    }
    
    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    input:checked + .toggle-slider {
        background-color: #4F46E5;
    }
    
    input:checked + .toggle-slider:before {
        transform: translateX(24px);
    }
    
    .config-search-highlight {
        background-color: #FEF3C7;
        padding: 2px 4px;
        border-radius: 4px;
        animation: highlight 2s ease-in-out;
    }
    
    @keyframes highlight {
        0% { background-color: #FEF3C7; }
        50% { background-color: #FDE68A; }
        100% { background-color: #FEF3C7; }
    }
    
    .save-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        transform: translateX(400px);
        transition: all 0.3s ease;
    }
    
    .save-indicator.show {
        transform: translateX(0);
    }
    
    .config-divider {
        background: linear-gradient(90deg, transparent, #E5E7EB, transparent);
        height: 1px;
        margin: 2rem 0;
    }
    
    .category-icon {
        background: linear-gradient(135deg, var(--tw-gradient-from), var(--tw-gradient-to));
        transition: all 0.3s ease;
    }
    
    .category-icon:hover {
        transform: scale(1.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="p-8 max-w-7xl mx-auto">
    <!-- Header Section -->
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
        <div>
            <nav class="flex items-center space-x-2 text-sm text-gray-500 mb-2">
                <a href="{% url 'utilitarios:dashboard' %}" class="hover:text-guto-blue">Utilitários</a>
                <i class="fas fa-chevron-right text-xs"></i>
                <span class="text-gray-900">Configurações</span>
            </nav>
            <h1 class="text-4xl font-bold text-gray-900 mb-2">
                <i class="fas fa-cogs text-orange-600 mr-3"></i>
                Centro de Configurações
            </h1>
            <p class="text-lg text-gray-600">Configure e personalize o comportamento do sistema GUTO</p>
            <div class="flex items-center mt-3 space-x-4 text-sm text-gray-500">
                <span class="flex items-center">
                    <i class="fas fa-database mr-1"></i>
                    {{ configuracoes.count|default:"0" }} configurações
                </span>
                <span class="flex items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                    Todas sincronizadas
                </span>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="flex flex-wrap gap-3 mt-4 lg:mt-0">
            <button id="backupConfigs" class="flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition-all duration-300 shadow-lg hover:shadow-xl">
                <i class="fas fa-download w-4 h-4"></i>
                <span>Backup</span>
            </button>
            <button id="importConfigs" class="flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl">
                <i class="fas fa-upload w-4 h-4"></i>
                <span>Importar</span>
            </button>
            <button id="resetToDefaults" class="flex items-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-xl hover:bg-red-700 transition-all duration-300 shadow-lg hover:shadow-xl">
                <i class="fas fa-undo w-4 h-4"></i>
                <span>Restaurar Padrões</span>
            </button>
        </div>
    </div>

    <!-- Search and Quick Access -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-8">
        <div class="bg-gradient-to-r from-gray-50 to-orange-50 px-6 py-4 border-b border-gray-100">
            <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="fas fa-search text-orange-600 mr-3"></i>
                Busca Inteligente
            </h2>
        </div>
        
        <div class="p-6">
            <div class="flex flex-wrap gap-4">
                <div class="flex-1 min-w-64">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="configSearch" 
                               placeholder="Buscar configurações por nome, descrição ou categoria..." 
                               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                    </div>
                </div>
                
                <div class="min-w-48">
                    <select id="categoryFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="">Todas as categorias</option>
                        <option value="sistema">Sistema</option>
                        <option value="seguranca">Segurança</option>
                        <option value="email">E-mail</option>
                        <option value="backup">Backup</option>
                        <option value="interface">Interface</option>
                        <option value="notificacoes">Notificações</option>
                    </select>
                </div>
            </div>
            
            <!-- Quick Access Buttons -->
            <div class="flex flex-wrap gap-2 mt-4">
                <button class="config-quick-access px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-orange-100 hover:text-orange-700 transition-all" data-config="backup">
                    <i class="fas fa-shield-alt mr-2"></i>Backup Automático
                </button>
                <button class="config-quick-access px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-orange-100 hover:text-orange-700 transition-all" data-config="email">
                    <i class="fas fa-envelope mr-2"></i>Configurações de E-mail
                </button>
                <button class="config-quick-access px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-orange-100 hover:text-orange-700 transition-all" data-config="security">
                    <i class="fas fa-lock mr-2"></i>Segurança
                </button>
                <button class="config-quick-access px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-orange-100 hover:text-orange-700 transition-all" data-config="maintenance">
                    <i class="fas fa-tools mr-2"></i>Manutenção
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <!-- Category Sidebar -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden sticky top-8">
                <div class="bg-gradient-to-r from-gray-50 to-purple-50 px-6 py-4 border-b border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                        <i class="fas fa-layer-group text-purple-600 mr-2"></i>
                        Categorias
                    </h3>
                </div>
                
                <div class="p-4">
                    <div class="space-y-2">
                        <!-- Sistema -->
                        <div class="config-category p-3 rounded-lg cursor-pointer active" data-category="sistema">
                            <div class="flex items-center">
                                <div class="category-icon w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mr-3">
                                    <i class="fas fa-cog text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">Sistema</div>
                                    <div class="text-xs text-gray-500">Configurações gerais</div>
                                </div>
                            </div>
                        </div>

                        <!-- Segurança -->
                        <div class="config-category p-3 rounded-lg cursor-pointer" data-category="seguranca">
                            <div class="flex items-center">
                                <div class="category-icon w-10 h-10 rounded-lg bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center mr-3">
                                    <i class="fas fa-shield-alt text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">Segurança</div>
                                    <div class="text-xs text-gray-500">Proteção e acesso</div>
                                </div>
                            </div>
                        </div>

                        <!-- E-mail -->
                        <div class="config-category p-3 rounded-lg cursor-pointer" data-category="email">
                            <div class="flex items-center">
                                <div class="category-icon w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center mr-3">
                                    <i class="fas fa-envelope text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">E-mail</div>
                                    <div class="text-xs text-gray-500">SMTP e notificações</div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup -->
                        <div class="config-category p-3 rounded-lg cursor-pointer" data-category="backup">
                            <div class="flex items-center">
                                <div class="category-icon w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center mr-3">
                                    <i class="fas fa-database text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">Backup</div>
                                    <div class="text-xs text-gray-500">Cópias de segurança</div>
                                </div>
                            </div>
                        </div>

                        <!-- Interface -->
                        <div class="config-category p-3 rounded-lg cursor-pointer" data-category="interface">
                            <div class="flex items-center">
                                <div class="category-icon w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center mr-3">
                                    <i class="fas fa-palette text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">Interface</div>
                                    <div class="text-xs text-gray-500">Aparência e tema</div>
                                </div>
                            </div>
                        </div>

                        <!-- Notificações -->
                        <div class="config-category p-3 rounded-lg cursor-pointer" data-category="notificacoes">
                            <div class="flex items-center">
                                <div class="category-icon w-10 h-10 rounded-lg bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center mr-3">
                                    <i class="fas fa-bell text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">Notificações</div>
                                    <div class="text-xs text-gray-500">Alertas e avisos</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Panels -->
        <div class="lg:col-span-3">
            
            <!-- Sistema Category -->
            <div id="categoria-sistema" class="category-panel">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 px-6 py-4 border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-cog text-blue-600 mr-3"></i>
                            Configurações do Sistema
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">Configurações gerais e comportamento do sistema</p>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Nome do Sistema -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Nome do Sistema</label>
                                    <p class="text-xs text-gray-500">Nome exibido no cabeçalho e documentos</p>
                                </div>
                                <div class="text-blue-600">
                                    <i class="fas fa-tag"></i>
                                </div>
                            </div>
                            <input type="text" name="sistema_nome" value="GUTO - Sistema de Gestão Escolar" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- URL Base -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">URL Base do Sistema</label>
                                    <p class="text-xs text-gray-500">URL principal para acesso ao sistema</p>
                                </div>
                                <div class="text-blue-600">
                                    <i class="fas fa-link"></i>
                                </div>
                            </div>
                            <input type="url" name="sistema_url" value="https://guto.edu.br" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- Timezone -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Fuso Horário</label>
                                    <p class="text-xs text-gray-500">Fuso horário padrão do sistema</p>
                                </div>
                                <div class="text-blue-600">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <select name="sistema_timezone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="America/Sao_Paulo" selected>América/São Paulo (GMT-3)</option>
                                <option value="America/Manaus">América/Manaus (GMT-4)</option>
                                <option value="America/Rio_Branco">América/Rio Branco (GMT-5)</option>
                            </select>
                        </div>

                        <!-- Modo Manutenção -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Modo Manutenção</label>
                                    <p class="text-xs text-gray-500">Bloquear acesso temporariamente para manutenção</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="sistema_manutencao">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Segurança Category -->
            <div id="categoria-seguranca" class="category-panel hidden">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-red-50 to-red-100 px-6 py-4 border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-shield-alt text-red-600 mr-3"></i>
                            Configurações de Segurança
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">Proteção, autenticação e controle de acesso</p>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Tempo Sessão -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Tempo Limite da Sessão</label>
                                    <p class="text-xs text-gray-500">Tempo em minutos para logout automático</p>
                                </div>
                                <div class="text-red-600">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <input type="range" name="security_session_timeout" min="15" max="480" value="120" 
                                       class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                                <span class="text-sm font-medium text-gray-700 min-w-16" id="sessionTimeoutValue">120 min</span>
                            </div>
                        </div>

                        <!-- Força Senha -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Exigir Senha Forte</label>
                                    <p class="text-xs text-gray-500">Mínimo 8 caracteres, maiúsculas, números e símbolos</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="security_strong_password" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 2FA -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Autenticação de Dois Fatores</label>
                                    <p class="text-xs text-gray-500">Exigir código adicional para login</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="security_2fa">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Tentativas Login -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Limite de Tentativas de Login</label>
                                    <p class="text-xs text-gray-500">Bloqueio temporário após tentativas falhas</p>
                                </div>
                                <div class="text-red-600">
                                    <i class="fas fa-ban"></i>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500">Tentativas</label>
                                    <input type="number" name="security_max_attempts" value="3" min="1" max="10" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500">Bloqueio (min)</label>
                                    <input type="number" name="security_lockout_time" value="15" min="5" max="60" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- E-mail Category -->
            <div id="categoria-email" class="category-panel hidden">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-green-100 px-6 py-4 border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-envelope text-green-600 mr-3"></i>
                            Configurações de E-mail
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">SMTP, templates e notificações por e-mail</p>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- SMTP Server -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Servidor SMTP</label>
                                    <p class="text-xs text-gray-500">Configurações do servidor de e-mail</p>
                                </div>
                                <div class="text-green-600">
                                    <i class="fas fa-server"></i>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500">Servidor</label>
                                    <input type="text" name="email_smtp_host" value="smtp.gmail.com" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500">Porta</label>
                                    <input type="number" name="email_smtp_port" value="587" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                            </div>
                        </div>

                        <!-- E-mail Remetente -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">E-mail Remetente</label>
                                    <p class="text-xs text-gray-500">E-mail usado para envio de notificações</p>
                                </div>
                                <div class="text-green-600">
                                    <i class="fas fa-at"></i>
                                </div>
                            </div>
                            <input type="email" name="email_from" value="noreply@guto.edu.br" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>

                        <!-- SSL/TLS -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Usar Criptografia SSL/TLS</label>
                                    <p class="text-xs text-gray-500">Conexão segura com o servidor SMTP</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="email_use_tls" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Testar Configuração -->
                        <div class="config-card bg-blue-50 rounded-xl p-4 border border-blue-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-semibold text-blue-900">Testar Configurações</label>
                                    <p class="text-xs text-blue-700">Enviar e-mail de teste para verificar configurações</p>
                                </div>
                                <button id="testEmail" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-paper-plane mr-2"></i>Enviar Teste
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup Category -->
            <div id="categoria-backup" class="category-panel hidden">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 px-6 py-4 border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-database text-purple-600 mr-3"></i>
                            Configurações de Backup
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">Backups automáticos e política de retenção</p>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Backup Automático -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Backup Automático</label>
                                    <p class="text-xs text-gray-500">Executar backups programados automaticamente</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="backup_auto" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mt-4">
                                <div>
                                    <label class="text-xs text-gray-500">Frequência</label>
                                    <select name="backup_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="daily" selected>Diário</option>
                                        <option value="weekly">Semanal</option>
                                        <option value="monthly">Mensal</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500">Horário</label>
                                    <input type="time" name="backup_time" value="02:00" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                            </div>
                        </div>

                        <!-- Retenção -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Política de Retenção</label>
                                    <p class="text-xs text-gray-500">Quantos backups manter armazenados</p>
                                </div>
                                <div class="text-purple-600">
                                    <i class="fas fa-history"></i>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-xs text-gray-500">Diários</label>
                                    <input type="number" name="backup_daily_retain" value="7" min="1" max="31" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500">Semanais</label>
                                    <input type="number" name="backup_weekly_retain" value="4" min="1" max="12" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500">Mensais</label>
                                    <input type="number" name="backup_monthly_retain" value="6" min="1" max="12" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                            </div>
                        </div>

                        <!-- Local de Armazenamento -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Local de Armazenamento</label>
                                    <p class="text-xs text-gray-500">Onde os backups serão armazenados</p>
                                </div>
                                <div class="text-purple-600">
                                    <i class="fas fa-folder"></i>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="radio" name="backup_storage" value="local" checked class="mr-3">
                                    <span class="text-sm">Armazenamento Local</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="backup_storage" value="cloud" class="mr-3">
                                    <span class="text-sm">Nuvem (AWS S3, Google Drive)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="backup_storage" value="both" class="mr-3">
                                    <span class="text-sm">Ambos (Local + Nuvem)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interface Category -->
            <div id="categoria-interface" class="category-panel hidden">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-indigo-50 to-indigo-100 px-6 py-4 border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-palette text-indigo-600 mr-3"></i>
                            Configurações de Interface
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">Aparência, tema e personalização visual</p>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Tema -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Tema do Sistema</label>
                                    <p class="text-xs text-gray-500">Esquema de cores padrão</p>
                                </div>
                                <div class="text-indigo-600">
                                    <i class="fas fa-brush"></i>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <label class="cursor-pointer">
                                    <input type="radio" name="theme" value="light" checked class="sr-only peer">
                                    <div class="p-3 border-2 border-gray-300 rounded-lg peer-checked:border-indigo-500 peer-checked:bg-indigo-50">
                                        <div class="w-full h-12 bg-white rounded border mb-2"></div>
                                        <div class="text-xs text-center">Claro</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="theme" value="dark" class="sr-only peer">
                                    <div class="p-3 border-2 border-gray-300 rounded-lg peer-checked:border-indigo-500 peer-checked:bg-indigo-50">
                                        <div class="w-full h-12 bg-gray-800 rounded border mb-2"></div>
                                        <div class="text-xs text-center">Escuro</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="theme" value="auto" class="sr-only peer">
                                    <div class="p-3 border-2 border-gray-300 rounded-lg peer-checked:border-indigo-500 peer-checked:bg-indigo-50">
                                        <div class="w-full h-12 bg-gradient-to-r from-white to-gray-800 rounded border mb-2"></div>
                                        <div class="text-xs text-center">Automático</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Logo Customizado -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Logo Personalizado</label>
                                    <p class="text-xs text-gray-500">Upload do logo da instituição</p>
                                </div>
                                <div class="text-indigo-600">
                                    <i class="fas fa-image"></i>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-school text-gray-400 text-xl"></i>
                                </div>
                                <div class="flex-1">
                                    <input type="file" name="custom_logo" accept="image/*" class="hidden" id="logoUpload">
                                    <label for="logoUpload" class="cursor-pointer bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors inline-block">
                                        <i class="fas fa-upload mr-2"></i>Escolher Logo
                                    </label>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG até 2MB - 200x200px recomendado</p>
                                </div>
                            </div>
                        </div>

                        <!-- Densidade da Interface -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Densidade da Interface</label>
                                    <p class="text-xs text-gray-500">Espaçamento entre elementos</p>
                                </div>
                                <div class="text-indigo-600">
                                    <i class="fas fa-expand-arrows-alt"></i>
                                </div>
                            </div>
                            <div class="flex space-x-4">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="density" value="compact" class="mr-2">
                                    <span class="text-sm">Compacta</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="density" value="normal" checked class="mr-2">
                                    <span class="text-sm">Normal</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="density" value="comfortable" class="mr-2">
                                    <span class="text-sm">Confortável</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notificações Category -->
            <div id="categoria-notificacoes" class="category-panel hidden">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 px-6 py-4 border-b border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-bell text-yellow-600 mr-3"></i>
                            Configurações de Notificações
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">Alertas, avisos e notificações do sistema</p>
                    </div>
                    
                    <div class="p-6 space-y-6">
                        <!-- Notificações por E-mail -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Notificações por E-mail</label>
                                    <p class="text-xs text-gray-500">Enviar notificações por e-mail</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="notifications_email" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="space-y-2 pl-4 border-l-2 border-gray-200">
                                <label class="flex items-center">
                                    <input type="checkbox" name="notify_login" checked class="mr-3">
                                    <span class="text-sm">Novos logins</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="notify_backup" checked class="mr-3">
                                    <span class="text-sm">Status do backup</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="notify_errors" checked class="mr-3">
                                    <span class="text-sm">Erros do sistema</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="notify_security" checked class="mr-3">
                                    <span class="text-sm">Alertas de segurança</span>
                                </label>
                            </div>
                        </div>

                        <!-- Notificações Push -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Notificações Push</label>
                                    <p class="text-xs text-gray-500">Notificações no navegador</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="notifications_push">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Frequência de Relatórios -->
                        <div class="config-card bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <label class="text-sm font-semibold text-gray-900">Relatórios Automáticos</label>
                                    <p class="text-xs text-gray-500">Envio programado de relatórios</p>
                                </div>
                                <div class="text-yellow-600">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                            </div>
                            <select name="reports_frequency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                                <option value="never">Nunca</option>
                                <option value="daily">Diário</option>
                                <option value="weekly" selected>Semanal</option>
                                <option value="monthly">Mensal</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button Fixed -->
            <div class="sticky bottom-8 mt-8">
                <div class="flex items-center justify-center">
                    <button id="saveAllConfigs" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-4 rounded-2xl hover:from-orange-600 hover:to-red-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="fas fa-save mr-3 text-xl"></i>
                        <span class="text-lg font-semibold">Salvar Todas as Configurações</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Save Indicator -->
<div id="saveIndicator" class="save-indicator bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg">
    <div class="flex items-center">
        <i class="fas fa-check-circle mr-3"></i>
        <span>Configurações salvas com sucesso!</span>
    </div>
</div>

<!-- Advanced Configuration JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Category Navigation
    const categoryButtons = document.querySelectorAll('.config-category');
    const categoryPanels = document.querySelectorAll('.category-panel');
    
    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.getAttribute('data-category');
            
            // Remove active class from all buttons
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            
            // Add active class to clicked button
            this.classList.add('active');
            
            // Hide all panels
            categoryPanels.forEach(panel => panel.classList.add('hidden'));
            
            // Show selected panel
            const targetPanel = document.getElementById(`categoria-${category}`);
            if (targetPanel) {
                targetPanel.classList.remove('hidden');
            }
            
            // Update URL hash
            window.location.hash = category;
        });
    });
    
    // Load category from URL hash
    if (window.location.hash) {
        const category = window.location.hash.substring(1);
        const categoryButton = document.querySelector(`[data-category="${category}"]`);
        if (categoryButton) {
            categoryButton.click();
        }
    }
    
    // Search Functionality
    const searchInput = document.getElementById('configSearch');
    const categoryFilter = document.getElementById('categoryFilter');
    
    function performSearch() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCategory = categoryFilter.value;
        
        categoryPanels.forEach(panel => {
            const configs = panel.querySelectorAll('.config-card');
            let hasVisibleConfigs = false;
            
            configs.forEach(config => {
                const text = config.textContent.toLowerCase();
                const matchesSearch = !searchTerm || text.includes(searchTerm);
                const matchesCategory = !selectedCategory || panel.id.includes(selectedCategory);
                
                if (matchesSearch && matchesCategory) {
                    config.style.display = 'block';
                    hasVisibleConfigs = true;
                    
                    // Highlight search terms
                    if (searchTerm) {
                        highlightSearchTerm(config, searchTerm);
                    }
                } else {
                    config.style.display = 'none';
                }
            });
            
            // Show/hide entire category panels based on matches
            if (hasVisibleConfigs && (!selectedCategory || panel.id.includes(selectedCategory))) {
                panel.classList.remove('hidden');
            } else if (searchTerm || selectedCategory) {
                panel.classList.add('hidden');
            }
        });
        
        // Update category buttons
        if (searchTerm || selectedCategory) {
            categoryButtons.forEach(btn => {
                const category = btn.getAttribute('data-category');
                const panel = document.getElementById(`categoria-${category}`);
                
                if (panel && !panel.classList.contains('hidden')) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
    }
    
    function highlightSearchTerm(element, term) {
        // Remove previous highlights
        element.querySelectorAll('.config-search-highlight').forEach(highlight => {
            highlight.outerHTML = highlight.innerHTML;
        });
        
        // Add new highlights
        const walker = document.createTreeWalker(
            element,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );
        
        const textNodes = [];
        let node;
        
        while (node = walker.nextNode()) {
            textNodes.push(node);
        }
        
        textNodes.forEach(textNode => {
            const parent = textNode.parentNode;
            if (parent.tagName !== 'INPUT' && parent.tagName !== 'TEXTAREA') {
                const text = textNode.textContent;
                const regex = new RegExp(`(${term})`, 'gi');
                
                if (regex.test(text)) {
                    const highlightedHTML = text.replace(regex, '<span class="config-search-highlight">$1</span>');
                    const temp = document.createElement('div');
                    temp.innerHTML = highlightedHTML;
                    
                    while (temp.firstChild) {
                        parent.insertBefore(temp.firstChild, textNode);
                    }
                    parent.removeChild(textNode);
                }
            }
        });
    }
    
    searchInput.addEventListener('input', debounce(performSearch, 300));
    categoryFilter.addEventListener('change', performSearch);
    
    // Quick Access Buttons
    const quickAccessButtons = document.querySelectorAll('.config-quick-access');
    quickAccessButtons.forEach(button => {
        button.addEventListener('click', function() {
            const configType = this.getAttribute('data-config');
            
            // Clear search and filters
            searchInput.value = '';
            categoryFilter.value = '';
            
            // Search for the config type
            searchInput.value = configType;
            performSearch();
            
            // Add visual feedback
            this.classList.add('bg-orange-200', 'text-orange-800');
            setTimeout(() => {
                this.classList.remove('bg-orange-200', 'text-orange-800');
            }, 1000);
        });
    });
    
    // Range Slider Updates
    const sessionTimeoutSlider = document.querySelector('input[name="security_session_timeout"]');
    const sessionTimeoutValue = document.getElementById('sessionTimeoutValue');
    
    if (sessionTimeoutSlider && sessionTimeoutValue) {
        sessionTimeoutSlider.addEventListener('input', function() {
            sessionTimeoutValue.textContent = `${this.value} min`;
        });
    }
    
    // Toggle Switches
    const toggles = document.querySelectorAll('input[type="checkbox"]');
    toggles.forEach(toggle => {
        toggle.addEventListener('change', function() {
            // Add visual feedback
            const card = this.closest('.config-card');
            if (card) {
                card.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    card.style.transform = 'scale(1)';
                }, 200);
            }
            
            // Auto-save for critical settings
            if (this.name === 'sistema_manutencao' || this.name === 'security_2fa') {
                showSaveIndicator('Configuração crítica alterada - salvamento automático');
                setTimeout(() => {
                    saveConfiguration(this.name, this.checked);
                }, 500);
            }
        });
    });
    
    // Test Email Button
    document.getElementById('testEmail').addEventListener('click', function() {
        const button = this;
        const originalContent = button.innerHTML;
        
        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';
        button.disabled = true;
        
        // Simulate email test
        setTimeout(() => {
            showSaveIndicator('E-mail de teste enviado com sucesso!');
            button.innerHTML = originalContent;
            button.disabled = false;
        }, 2000);
    });
    
    // Backup/Import Buttons
    document.getElementById('backupConfigs').addEventListener('click', function() {
        const configs = gatherAllConfigurations();
        downloadBackup(configs);
        showSaveIndicator('Backup de configurações baixado');
    });
    
    document.getElementById('importConfigs').addEventListener('click', function() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                importConfigurations(file);
            }
        };
        input.click();
    });
    
    document.getElementById('resetToDefaults').addEventListener('click', function() {
        if (confirm('Tem certeza que deseja restaurar todas as configurações para os valores padrão? Esta ação não pode ser desfeita.')) {
            resetToDefaults();
            showSaveIndicator('Configurações restauradas para os padrões');
        }
    });
    
    // Save All Configurations
    document.getElementById('saveAllConfigs').addEventListener('click', function() {
        const button = this;
        const originalContent = button.innerHTML;
        
        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-3 text-xl"></i><span class="text-lg font-semibold">Salvando...</span>';
        button.disabled = true;
        
        const configs = gatherAllConfigurations();
        
        // Simulate save process
        setTimeout(() => {
            saveAllConfigurations(configs);
            showSaveIndicator('Todas as configurações foram salvas com sucesso!');
            
            button.innerHTML = originalContent;
            button.disabled = false;
            
            // Add success animation
            button.classList.add('bg-green-500');
            setTimeout(() => {
                button.classList.remove('bg-green-500');
            }, 2000);
        }, 1500);
    });
    
    // Auto-save functionality
    let autoSaveTimeout;
    const formInputs = document.querySelectorAll('input, select, textarea');
    
    formInputs.forEach(input => {
        input.addEventListener('change', function() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                if (!this.name.includes('critical')) {
                    autoSaveConfiguration(this.name, this.value || this.checked);
                }
            }, 2000);
        });
    });
    
    // Helper Functions
    function gatherAllConfigurations() {
        const configs = {};
        formInputs.forEach(input => {
            if (input.name) {
                if (input.type === 'checkbox') {
                    configs[input.name] = input.checked;
                } else if (input.type === 'radio' && input.checked) {
                    configs[input.name] = input.value;
                } else if (input.type !== 'radio') {
                    configs[input.name] = input.value;
                }
            }
        });
        return configs;
    }
    
    function saveAllConfigurations(configs) {
        // Here you would send configs to the server
        console.log('Saving configurations:', configs);
        
        // Store in localStorage as backup
        localStorage.setItem('guto_configs', JSON.stringify(configs));
    }
    
    function saveConfiguration(name, value) {
        console.log(`Auto-saving ${name}:`, value);
    }
    
    function autoSaveConfiguration(name, value) {
        console.log(`Auto-saving ${name}:`, value);
        
        // Visual indicator for auto-save
        const input = document.querySelector(`[name="${name}"]`);
        if (input) {
            const card = input.closest('.config-card');
            if (card) {
                card.style.borderLeft = '4px solid #10B981';
                setTimeout(() => {
                    card.style.borderLeft = '';
                }, 1000);
            }
        }
    }
    
    function downloadBackup(configs) {
        const dataStr = JSON.stringify(configs, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `guto-config-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
    }
    
    function importConfigurations(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const configs = JSON.parse(e.target.result);
                
                // Apply configurations to form
                Object.keys(configs).forEach(key => {
                    const input = document.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = configs[key];
                        } else if (input.type === 'radio') {
                            if (input.value === configs[key]) {
                                input.checked = true;
                            }
                        } else {
                            input.value = configs[key];
                        }
                    }
                });
                
                showSaveIndicator('Configurações importadas com sucesso!');
            } catch (error) {
                alert('Erro ao importar configurações: arquivo inválido');
            }
        };
        reader.readAsText(file);
    }
    
    function resetToDefaults() {
        // Reset all form fields to their default values
        const form = document.querySelector('form') || document.body;
        if (form.reset) {
            form.reset();
        } else {
            formInputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = input.hasAttribute('checked');
                } else if (input.type === 'radio') {
                    input.checked = input.hasAttribute('checked');
                } else {
                    input.value = input.defaultValue || '';
                }
            });
        }
    }
    
    function showSaveIndicator(message) {
        const indicator = document.getElementById('saveIndicator');
        indicator.querySelector('span').textContent = message;
        indicator.classList.add('show');
        
        setTimeout(() => {
            indicator.classList.remove('show');
        }, 3000);
    }
    
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
});
</script>
{% endblock %}