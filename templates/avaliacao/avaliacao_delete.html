{% extends 'base.html' %}
{% load static %}

{% block title %}Excluir Avaliação - GUTO{% endblock %}

{% block extra_css %}
<style>
    .warning-card {
        animation: slideIn 0.5s ease-out;
        border-left: 6px solid #EF4444;
    }
    
    .danger-btn {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    .danger-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -8px rgba(239, 68, 68, 0.5);
    }
    .danger-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    .danger-btn:hover::before {
        left: 100%;
    }
    
    .info-item {
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }
    .info-item:hover {
        border-left-color: #EF4444;
        background-color: #FEF2F2;
        transform: translateX(4px);
    }
    
    .floating-element {
        animation: float 6s ease-in-out infinite;
    }
    
    .pulse-warning {
        animation: pulseWarning 2s infinite;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        33% { transform: translateY(-10px) rotate(1deg); }
        66% { transform: translateY(-5px) rotate(-1deg); }
    }
    
    @keyframes pulseWarning {
        0%, 100% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.05);
            opacity: 0.8;
        }
    }
    
    .checkbox-custom {
        appearance: none;
        width: 20px;
        height: 20px;
        border: 2px solid #EF4444;
        border-radius: 4px;
        position: relative;
        transition: all 0.3s ease;
    }
    
    .checkbox-custom:checked {
        background-color: #EF4444;
        border-color: #EF4444;
    }
    
    .checkbox-custom:checked::before {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 14px;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="p-8 max-w-4xl mx-auto">
    
    <!-- Page Header -->
    <div class="relative mb-8 overflow-hidden rounded-3xl">
        <div class="absolute inset-0 bg-gradient-to-r from-red-600 via-red-700 to-red-800 opacity-90"></div>
        <div class="absolute top-0 right-0 w-96 h-96 bg-white bg-opacity-10 rounded-full -translate-y-48 translate-x-48 floating-element"></div>
        <div class="absolute bottom-0 left-0 w-64 h-64 bg-white bg-opacity-5 rounded-full translate-y-32 -translate-x-32 floating-element" style="animation-delay: -2s;"></div>
        
        <div class="relative p-8 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <div class="flex items-center mb-4">
                        <div class="p-4 bg-white bg-opacity-20 rounded-2xl mr-4 pulse-warning">
                            <i class="fas fa-exclamation-triangle text-3xl"></i>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold mb-1">Excluir Avaliação</h1>
                            <p class="text-xl text-white text-opacity-90">Esta ação não pode ser desfeita</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <span class="w-3 h-3 bg-red-400 rounded-full animate-pulse"></span>
                        <span class="text-sm">Ação destrutiva - Cuidado!</span>
                    </div>
                </div>
                
                <div class="hidden lg:block">
                    <div class="bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 floating-element">
                        <i class="fas fa-trash text-4xl"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Message -->
    <div class="warning-card bg-red-50 border border-red-200 rounded-2xl shadow-lg mb-8">
        <div class="p-8">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                    </div>
                </div>
                <div class="ml-6 flex-1">
                    <h3 class="text-2xl font-bold text-red-900 mb-4">⚠️ ATENÇÃO: Esta ação é irreversível!</h3>
                    
                    <div class="space-y-3 text-red-800">
                        <p class="flex items-center">
                            <i class="fas fa-times-circle mr-3 text-red-600"></i>
                            <strong>A avaliação será permanentemente excluída</strong>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-times-circle mr-3 text-red-600"></i>
                            <strong>Todas as notas associadas serão perdidas</strong>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-times-circle mr-3 text-red-600"></i>
                            <strong>Históricos e relatórios serão afetados</strong>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-times-circle mr-3 text-red-600"></i>
                            <strong>Esta operação não pode ser desfeita</strong>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Avaliação Details -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-8">
        <div class="bg-gradient-to-r from-gray-50 to-red-50 px-6 py-4 border-b border-gray-100">
            <h3 class="text-xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-info-circle text-red-600 mr-3"></i>
                Detalhes da Avaliação que será Excluída
            </h3>
        </div>
        
        <div class="p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <div class="info-item p-4 rounded-lg bg-gray-50">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-tag text-gray-400 mr-2"></i>
                        <h4 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Nome</h4>
                    </div>
                    <p class="text-lg font-semibold text-gray-900">{{ avaliacao.nome }}</p>
                </div>
                
                {% if avaliacao.tipo %}
                <div class="info-item p-4 rounded-lg bg-gray-50">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-list text-gray-400 mr-2"></i>
                        <h4 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Tipo</h4>
                    </div>
                    <p class="text-lg font-semibold text-gray-900">{{ avaliacao.tipo.nome }}</p>
                </div>
                {% endif %}
                
                {% if avaliacao.turma %}
                <div class="info-item p-4 rounded-lg bg-gray-50">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-users text-gray-400 mr-2"></i>
                        <h4 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Turma</h4>
                    </div>
                    <p class="text-lg font-semibold text-gray-900">{{ avaliacao.turma.nome }}</p>
                </div>
                {% endif %}
                
                {% if avaliacao.disciplina %}
                <div class="info-item p-4 rounded-lg bg-gray-50">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-book text-gray-400 mr-2"></i>
                        <h4 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Disciplina</h4>
                    </div>
                    <p class="text-lg font-semibold text-gray-900">{{ avaliacao.disciplina.nome }}</p>
                </div>
                {% endif %}
                
                {% if avaliacao.data_aplicacao %}
                <div class="info-item p-4 rounded-lg bg-gray-50">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-calendar text-gray-400 mr-2"></i>
                        <h4 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Data de Aplicação</h4>
                    </div>
                    <p class="text-lg font-semibold text-gray-900">{{ avaliacao.data_aplicacao|date:"d/m/Y" }}</p>
                </div>
                {% endif %}
                
                {% if avaliacao.peso %}
                <div class="info-item p-4 rounded-lg bg-gray-50">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-weight text-gray-400 mr-2"></i>
                        <h4 class="text-sm font-medium text-gray-700 uppercase tracking-wide">Peso</h4>
                    </div>
                    <p class="text-lg font-semibold text-gray-900">{{ avaliacao.peso }}</p>
                </div>
                {% endif %}
            </div>
            
            {% if avaliacao.descricao %}
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div class="flex items-center mb-2">
                    <i class="fas fa-comment-alt text-blue-500 mr-2"></i>
                    <h4 class="text-sm font-medium text-blue-700 uppercase tracking-wide">Descrição</h4>
                </div>
                <p class="text-gray-700 leading-relaxed">{{ avaliacao.descricao|linebreaksbr }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Impact Information -->
    <div class="bg-yellow-50 border border-yellow-200 rounded-2xl shadow-lg mb-8">
        <div class="p-8">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                </div>
                <div class="ml-6 flex-1">
                    <h3 class="text-xl font-bold text-yellow-900 mb-4">Impacto da Exclusão</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-lg border border-yellow-200">
                            <div class="text-center">
                                <i class="fas fa-star text-yellow-600 text-2xl mb-2"></i>
                                <h4 class="font-semibold text-yellow-900">Notas Perdidas</h4>
                                <p class="text-2xl font-bold text-yellow-700">{{ total_notas|default:0 }}</p>
                                <p class="text-sm text-yellow-600">notas de alunos</p>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg border border-yellow-200">
                            <div class="text-center">
                                <i class="fas fa-users text-yellow-600 text-2xl mb-2"></i>
                                <h4 class="font-semibold text-yellow-900">Alunos Afetados</h4>
                                <p class="text-2xl font-bold text-yellow-700">{{ alunos_afetados|default:0 }}</p>
                                <p class="text-sm text-yellow-600">estudantes</p>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg border border-yellow-200">
                            <div class="text-center">
                                <i class="fas fa-calendar text-yellow-600 text-2xl mb-2"></i>
                                <h4 class="font-semibold text-yellow-900">Data</h4>
                                <p class="text-lg font-bold text-yellow-700">{{ avaliacao.data_aplicacao|date:"d/m" }}</p>
                                <p class="text-sm text-yellow-600">será perdida</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Form -->
    <form method="post" class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
        {% csrf_token %}
        
        <div class="bg-gradient-to-r from-gray-50 to-red-50 px-6 py-4 border-b border-gray-100">
            <h3 class="text-xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-check-square text-red-600 mr-3"></i>
                Confirmação de Exclusão
            </h3>
            <p class="text-sm text-gray-600 mt-1">Confirme que deseja prosseguir com a exclusão</p>
        </div>
        
        <div class="p-8">
            <div class="space-y-6">
                
                <!-- Confirmation Checkboxes -->
                <div class="space-y-4">
                    <label class="flex items-start cursor-pointer">
                        <input type="checkbox" id="confirm-understand" class="checkbox-custom mt-1" required>
                        <span class="ml-3 text-gray-700">
                            <strong>Entendo</strong> que esta ação excluirá permanentemente a avaliação e todas as notas associadas.
                        </span>
                    </label>
                    
                    <label class="flex items-start cursor-pointer">
                        <input type="checkbox" id="confirm-backup" class="checkbox-custom mt-1" required>
                        <span class="ml-3 text-gray-700">
                            <strong>Confirmo</strong> que fiz backup dos dados importantes ou não preciso deles.
                        </span>
                    </label>
                    
                    <label class="flex items-start cursor-pointer">
                        <input type="checkbox" id="confirm-responsibility" class="checkbox-custom mt-1" required>
                        <span class="ml-3 text-gray-700">
                            <strong>Assumo a responsabilidade</strong> por esta ação e suas consequências.
                        </span>
                    </label>
                </div>
                
                <!-- Type confirmation -->
                <div class="border-t border-gray-200 pt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Para confirmar, digite o nome da avaliação: <strong class="text-red-600">{{ avaliacao.nome }}</strong>
                    </label>
                    <input type="text" id="confirm-name" placeholder="Digite o nome da avaliação" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" required>
                    <p class="mt-1 text-xs text-gray-500">Esta confirmação é obrigatória</p>
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="bg-gray-50 px-8 py-6 border-t border-gray-200">
            <div class="flex items-center justify-between">
                <a href="#" class="btn-voltar btn-voltar btn-voltar btn-voltar text-gray-600 hover:text-gray-900 transition-colors duration-200" onclick="event.preventDefault(); window.gutoNav?.goBack() || history.back();">
                    <i class="fas fa-arrow-left mr-2"></i>Voltar
                </a>
                
                <div class="flex items-center space-x-4">
                    <a href="{% url 'avaliacao:avaliacoes_list' %}" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors duration-200">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </a>
                    <button type="submit" id="delete-btn" disabled
                            class="danger-btn bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed">
                        <i class="fas fa-trash mr-2"></i>Excluir Definitivamente
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const nameInput = document.getElementById('confirm-name');
    const deleteBtn = document.getElementById('delete-btn');
    const expectedName = "{{ avaliacao.nome }}";
    
    function validateForm() {
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        const nameMatches = nameInput.value.trim() === expectedName;
        
        deleteBtn.disabled = !(allChecked && nameMatches);
        
        if (allChecked && nameMatches) {
            deleteBtn.classList.remove('bg-gray-400', 'disabled:bg-gray-400');
            deleteBtn.classList.add('bg-red-600', 'hover:bg-red-700');
        } else {
            deleteBtn.classList.add('bg-gray-400', 'disabled:bg-gray-400');
            deleteBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
        }
    }
    
    // Add event listeners
    checkboxes.forEach(cb => cb.addEventListener('change', validateForm));
    nameInput.addEventListener('input', validateForm);
    
    // Form submission confirmation
    document.querySelector('form').addEventListener('submit', function(e) {
        if (!confirm('ÚLTIMA CONFIRMAÇÃO: Tem certeza absoluta de que deseja excluir esta avaliação? Esta ação é IRREVERSÍVEL!')) {
            e.preventDefault();
        }
    });

    // Animate info items
    const infoItems = document.querySelectorAll('.info-item');
    infoItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        setTimeout(() => {
            item.style.transition = 'all 0.5s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}